# Sub-Component 5.3: Branch Variation Generator

## Purpose
Generate multiple distinct branch variations from a premise — fleshing out the "what if" into a full branch concept with trajectory, consequences, and narrative arc.

---

## Requirements Gathering

### Question 1: Default Branch Count

**How many branches should be generated by default?**

Options:
- **A. 2 branches:** Binary choice (A or B)
- **B. 3 branches:** Small, medium, large divergence
- **C. 4 branches:** Multiple meaningful variations
- **D. 5 branches:** Comprehensive exploration
- **E. Anchor-dependent:** Based on anchor complexity

Considerations:
- Too few = limited exploration
- Too many = overwhelming, may have weak options
- Quality over quantity

### Question 2: Meaningful Difference Definition

**What defines "meaningfully different" vs. trivial variations?**

Options:
- **A. Scope:** Different number of characters affected
- **B. Direction:** Optimistic vs. pessimistic vs. neutral
- **C. Theme:** Each explores different thematic territory
- **D. Trajectory:** Different long-term story directions
- **E. Consequence type:** Personal vs. political vs. cosmic impact

Considerations:
- Trivial: "Kira runs left" vs "Kira runs right"
- Meaningful: "Kira saves village" vs "Kira saves herself"
- Need clear differentiation criteria

### Question 3: Theme Exploration

**Should branches explore different themes or just different outcomes?**

Options:
- **A. Outcomes only:** Same theme, different results
- **B. Theme variants:** Each branch emphasizes different theme
- **C. Theme progression:** Branches show theme escalation
- **D. Contrast pairs:** Hope vs. despair, duty vs. desire, etc.

Considerations:
- Different themes = more variety
- Same theme = coherent exploration of possibilities
- Pairs may be easier for users to choose between

### Question 4: Optimism/Pessimism Balance

**How should optimistic vs. pessimistic branches be balanced?**

Options:
- **A. All optimistic:** Hopeful outcomes only
- **B. All pessimistic:** Tragic outcomes only
- **C. Balanced mix:** User sees range of possibilities
- **D. User preference:** Generate based on user mood/preference
- **E. Story-appropriate:** Match original story's tone

Considerations:
- Some users prefer hopeful stories
- Some prefer dark/gritty
- Balance gives full picture of possibilities

### Question 5: Branch Trajectory Depth

**How deep should branch trajectory be defined?**

Options:
- **A. Immediate only:** Just the next few scenes
- **B. Short-term:** Next chapter or two
- **C. Arc outline:** Full story arc to conclusion
- **D. Adaptive depth:** Based on user intent (just exploring vs. full continuation)

Considerations:
- Deeper = better for Component 6 continuation
- Shallower = faster generation, less spoilery
- Component 6 needs enough to continue coherently

### Question 6: Character Arc Projection

**Should branches project character development arcs?**

Options:
- **A. No:** Focus on plot only
- **B. Major characters only:** MC + key supporting
- **C. All affected characters:** Anyone whose path changes
- **D. Dynamic:** Characters who would have significant growth

Considerations:
- Character arcs important for continuation quality
- Too many arcs = complex, hard to track
- Focus on meaningful character journeys

---

## Technical Considerations

### Branch Variation Structure

```typescript
interface BranchVariation {
  id: string;
  premiseId: string;
  
  // Identity
  name: string;
  description: string;
  
  // Trajectory
  trajectory: {
    immediate: string[];      // Next few scenes
    shortTerm: string;        // Next 1-2 chapters
    longTerm: string;         // Story direction
    estimatedChapters: number;
  };
  
  // Character journeys
  characterArcs: CharacterArc[];
  
  // World impact
  worldChanges: WorldChange[];
  
  // Narrative elements
  narrative: {
    keyScenes: string[];
    tone: string;
    pacing: 'faster' | 'slower' | 'similar';
    themes: string[];
  };
  
  // Comparison to original
  divergence: {
    similarityScore: number;  // 0-1 (0 = completely different)
    majorChanges: string[];
    whatStaysSame: string[];
  };
  
  // Metadata
  confidence: number;
  quality: number;
}
```

### Variation Generation Strategy

```typescript
interface VariationStrategy {
  // Based on anchor type
  strategy: 'magnitude' | 'character-perspective' | 'theme' | 'consequence-type';
  
  // Magnitude strategy: subtle/moderate/drastic
  // Character strategy: different POVs
  // Theme strategy: different thematic focus
  // Consequence strategy: personal/political/cosmic
}
```

---

## Decisions Recorded

| Question | Decision | Rationale |
|----------|----------|-----------|
| 1. Default Branch Count | **E. Anchor-dependent** | Based on anchor complexity - simple anchors fewer branches, complex more |
| 2. Meaningful Difference | **E. Consequence type** | Personal vs. political vs. cosmic impact creates clear differentiation |
| 3. Theme Exploration | **C. Theme progression** | Branches show theme escalation/deepening |
| 4. Optimism Balance | **D. User preference** | Generate based on user mood/preference selection |
| 5. Trajectory Depth | **D. Adaptive depth** | Based on user intent (exploring vs. full continuation) |
| 6. Character Arcs | **C. All affected characters** | Complete picture of how branch impacts everyone |

### Anchor-Dependent Branch Count

```typescript
function calculateBranchCount(anchor: AnchorEvent): number {
  const complexity = analyzeComplexity(anchor);
  
  // Simple decision with limited scope
  if (complexity === 'simple') return 2;
  
  // Moderate anchor with multiple factors
  if (complexity === 'moderate') return 3;
  
  // Complex anchor with wide-reaching implications
  if (complexity === 'complex') return 4;
  
  // Major story pivot with many possibilities
  if (complexity === 'major') return 5;
}

// Complexity factors:
// - Number of characters involved
// - Scope of impact (personal/local/world)
// - Type of anchor (decision has more branches than accident)
// - Narrative weight
```

### Consequence-Type Differentiation

```typescript
interface ConsequenceTypeBranches {
  // Each branch explores different scope of impact
  branches: [
    {
      type: 'personal',
      description: 'Impact primarily on protagonist and close relationships',
      scope: 'intimate',
      example: 'Kira saves herself but loses trust of allies'
    },
    {
      type: 'political',
      description: 'Impact on factions, power dynamics, groups',
      scope: 'factional',
      example: 'Kira\'s choice shifts balance between Empire and Resistance'
    },
    {
      type: 'cosmic',
      description: 'Impact on world, destiny, prophecy',
      scope: 'world-spanning',
      example: 'Kira\'s action awakens ancient power, changing fate of world'
    }
  ];
}
```

### Theme Progression Strategy

```typescript
interface ThemeProgression {
  // Branches escalate/deepen thematic exploration
  
  // Example: Sacrifice theme
  progression: [
    {
      branch: 1,
      theme: 'sacrifice',
      exploration: 'willing',  // Character willingly sacrifices
      depth: 'surface'
    },
    {
      branch: 2,
      theme: 'sacrifice',
      exploration: 'forced',   // Character forced to sacrifice
      depth: 'deeper'
    },
    {
      branch: 3,
      theme: 'sacrifice',
      exploration: 'futile',   // Sacrifice means nothing
      depth: 'darkest'
    }
  ];
}
```

### User Preference for Tone

```typescript
interface UserMoodPreferences {
  // User selects before generation
  preferredTone: 'hopeful' | 'tragic' | 'mixed' | 'dark' | 'bittersweet';
  
  // Or let AI decide based on original story
  matchOriginalTone: boolean;
  
  // Examples:
  // hopeful: More optimistic branches, redemption arcs
  // tragic: Sacrifices that fail, losses, doom
  // mixed: Balanced range across branches
  // dark: Corruption, moral compromise, pyrrhic victories
}

// If user picks "hopeful":
// Branch 1: Kira saves everyone (optimistic)
// Branch 2: Kira finds third way (creative solution)
// Branch 3: Sacrifice meaningful even if costly (noble)

// If user picks "dark":
// Branch 1: Kira's choice damns her (corruption)
// Branch 2: Victory at terrible cost (pyrrhic)
// Branch 3: Choice meaningless (nihilistic)
```

### Adaptive Trajectory Depth

```typescript
interface AdaptiveTrajectory {
  // User selects their intent
  userIntent: 'explore' | 'continue' | 'complete';
  
  // Depth adapts accordingly
  trajectory: {
    explore: {
      depth: 'immediate',      // Just next few scenes
      detail: 'high',          // Detailed scenes
      length: 'short'          // 500-1000 words
    },
    continue: {
      depth: 'short-term',     // Next 1-3 chapters
      detail: 'medium',        // Chapter outlines
      length: 'medium'         // 1000-3000 words
    },
    complete: {
      depth: 'arc-outline',    // Full story to conclusion
      detail: 'high',          // Detailed outline
      length: 'long'           // 3000-6000 words
    }
  };
}
```

### All Affected Character Arcs

```typescript
interface CharacterArcProjection {
  // For every character whose path changes
  arcs: CharacterArc[];
  
  // Arc structure
  arc: {
    characterId: string;
    startingState: string;      // At branch point
    projectedDevelopment: string; // How they grow/change
    keyMoments: string[];       // Critical scenes for this character
    endingState: string;        // Where they end up (if complete trajectory)
  };
  
  // May be 3-10+ characters depending on branch scope
  // Personal branches: 3-5 characters
  // Political branches: 5-10 characters
  // Cosmic branches: 8-15+ characters
}
```

---

## Status: ✅ Interrogation Complete

**Next: Sub-Component 5.4 — Consistency Validator**
