# Branch Generator: Sub-Component Breakdown

> Component 5 decomposed into 6 focused, implementable sub-components. Each will be interrogated separately.

---

## Sub-Component Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        BRANCH GENERATOR (Component 5)                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────┐     ┌──────────────────┐     ┌─────────────────┐ │
│  │   5.1 Context    │────▶│   5.2 Premise    │────▶│   5.3 Branch    │ │
│  │   Assembler      │     │   Generator      │     │   Variation     │ │
│  │                  │     │                  │     │   Generator     │ │
│  └──────────────────┘     └──────────────────┘     └────────┬────────┘ │
│           │                      │                         │           │
│           │                      │                         ▼           │
│           │                      │              ┌─────────────────┐    │
│           │                      │              │   5.4 Consistency│    │
│           │                      │              │   Validator     │    │
│           │                      │              └────────┬────────┘    │
│           │                      │                       │             │
│           ▼                      ▼                       ▼             │
│  ┌──────────────────────────────────────────────────────────────┐    │
│  │                    5.5 Branch Refiner                        │    │
│  │              (Quality improvement loop)                      │    │
│  └───────────────────────────┬──────────────────────────────────┘    │
│                              │                                         │
│                              ▼                                         │
│  ┌──────────────────────────────────────────────────────────────┐    │
│  │                    5.6 Branch Comparator                     │    │
│  │              (Compare branches, original, preview)           │    │
│  └──────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Sub-Component 5.1: Context Assembler

**Purpose:** Gather and organize all necessary context for branch generation from Components 3 and 4.

**Responsibilities:**
- Extract anchor event details
- Compile character states at branch point
- Assemble world state snapshot
- Gather narrative style profile
- Retrieve relationship dynamics
- Package context for LLM prompts

**Key Questions:**
1. What context is essential vs. nice-to-have for branch generation?
2. How much character history should be included?
3. Should we include events after the anchor (for contrast) or only before?
4. How do we handle spoilers the characters shouldn't know yet?

---

## Sub-Component 5.2: Premise Generator

**Purpose:** Generate the core "what if" premise for each branch.

**Responsibilities:**
- Transform alternative outcomes into compelling premises
- Generate "what if" statements
- Create branch titles and descriptions
- Establish branch identity and hook

**Key Questions:**
1. Should premises be dramatic hooks or neutral descriptions?
2. How do we ensure premises are distinct and not variations of the same idea?
3. Should user provide guidance on premise direction?
4. How many premise options per anchor?

---

## Sub-Component 5.3: Branch Variation Generator

**Purpose:** Generate multiple distinct branch variations from a single anchor.

**Responsibilities:**
- Generate 2-5 branch variations
- Ensure variations are meaningfully different
- Map immediate consequences for each
- Project short-term and long-term trajectories

**Key Questions:**
1. How many branches should be generated by default?
2. What defines "meaningfully different" vs. trivial variations?
3. Should branches explore different themes or just different outcomes?
4. How do we balance optimistic vs. pessimistic branches?

---

## Sub-Component 5.4: Consistency Validator

**Purpose:** Validate that generated branches maintain narrative consistency.

**Responsibilities:**
- Check character consistency (would X really do Y?)
- Verify world rule adherence
- Validate relationship dynamics
- Ensure narrative style match
- Flag inconsistencies for correction

**Key Questions:**
1. How strict should consistency checking be?
2. Should we allow some character growth/deviation from original?
3. What world elements are "hard rules" vs. flexible?
4. Should we auto-fix inconsistencies or flag for review?

---

## Sub-Component 5.5: Branch Refiner

**Purpose:** Improve branch quality through iteration and feedback.

**Responsibilities:**
- Quality assessment of generated branches
- Iterative refinement loop
- User feedback incorporation
- Consequence depth expansion

**Key Questions:**
1. How many refinement iterations should we attempt?
2. What triggers refinement (low confidence, user request)?
3. Should refinement focus on specific aspects (consequences, character arcs)?
4. When do we stop refining?

---

## Sub-Component 5.6: Branch Comparator

**Purpose:** Enable comparison between branches and the original timeline.

**Responsibilities:**
- Side-by-side branch comparison
- Divergence visualization
- Similarity/difference scoring
- Impact scope visualization

**Key Questions:**
1. What comparison dimensions are most useful?
2. Should we visualize as timeline diff or character impact matrix?
3. How do we quantify "similarity" between branches?
4. Should comparison include "what stays the same"?

---

## Interrogation Sequence

We will discuss each sub-component in order, gathering:
- Specific requirements and preferences
- Technical constraints
- Priority/focus areas
- Acceptance criteria

Ready to begin with **Sub-Component 5.1: Context Assembler**?
