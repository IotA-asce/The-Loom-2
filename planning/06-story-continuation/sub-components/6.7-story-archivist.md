# Sub-Component 6.7: Story Archivist

## Purpose
Manage storage, versioning, and export of generated stories — handling story organization, format conversion, and library management.

---

## Requirements Gathering

### Question 1: Version Retention

**How many versions should be kept per chapter?**

Options:
- **A. Last only:** Keep only final version
- **B. Last 5:** Keep recent 5 versions
- **C. All versions:** Unlimited version history
- **D. Marked versions:** Keep user-marked + last few
- **E. Smart retention:** Keep based on significance

Considerations:
- Storage costs
- But users may want to revisit old versions
- Important versions should be preserved

### Question 2: Branching from Generated Chapters

**Should we support branching from already-generated chapters?**

Options:
- **A. No:** Branch only from Component 5 branches
- **B. Yes, any point:** Can create new branch anywhere
- **C. Yes, chapter ends:** Branch at chapter boundaries
- **D. Yes, with limitations:** Limited number of sub-branches
- **E. Yes, full support:** Unlimited nested branching

Considerations:
- Nested branches = complex tree structure
- But gives maximum creative freedom
- May need visual tree representation

### Question 3: Essential Export Formats

**What export formats are essential?**

Rank by importance:
- Plain text (TXT)
- Markdown (MD)
- EPUB (ebook)
- PDF (formatted document)
- HTML (web format)
- DOCX (Word document)

### Question 4: Library Organization

**How should stories be organized in the library?**

Options:
- **A. Flat list:** All stories together
- **B. By source manga:** Group by original manga
- **C. By branch:** Tree structure from branches
- **D. By status:** In progress / Completed / Archived
- **E. Custom tags:** User-defined organization

Considerations:
- Users may have many stories
- Need to find stories easily
- Different users prefer different org

### Question 5: Search and Retrieval

**What search capabilities should be supported?**

Options:
- **A. Title only:** Search by story title
- **B. Full text:** Search within story content
- **C. Character-based:** Find stories with character
- **D. Tag-based:** Search by user tags
- **E. All of above:** Comprehensive search

Considerations:
- Full text search powerful but storage-heavy
- Tag search requires user effort
- Multiple options best

### Question 6: Sharing and Portability

**How should stories be shared or ported?**

Options:
- **A. Export only:** Download and share manually
- **B. Share links:** Generate shareable links
- **C. Cloud sync:** Sync across devices
- **D. Collaboration:** Share for co-editing
- **E. Publishing:** Publish to platform

Considerations:
- Users may want to share their stories
- Privacy important for personal content
- Multiple sharing options good

---

## Technical Considerations

### Storage Architecture

```typescript
interface StoryArchivist {
  // Storage
  storeChapter: (chapter: Chapter) => Promise<void>;
  retrieveChapter: (chapterId: string) => Promise<Chapter>;
  
  // Versioning
  saveVersion: (chapter: Chapter, metadata: VersionMetadata) => Version;
  listVersions: (chapterId: string) => Version[];
  
  // Export
  exportToFormat: (story: Story, format: ExportFormat) => Blob;
  
  // Organization
  organize: (story: Story, organization: OrganizationMethod) => void;
  search: (query: SearchQuery) => Story[];
}

type ExportFormat = 'txt' | 'md' | 'epub' | 'pdf' | 'html' | 'docx';
```

---

## Decisions Recorded

| Question | Decision | Rationale |
|----------|----------|-----------|
| 1. Version Retention | **C. All versions** | Unlimited version history preserved |
| 2. Branching from Generated Chapters | **B. Yes, any point** | Can create new branch anywhere in generated story |
| 3. Export Formats | **All in order** | TXT, MD, EPUB, PDF, HTML, DOCX - all supported |
| 4. Library Organization | **C. By branch** | Tree structure from branches |
| 5. Search Capabilities | **E. All of above** | Title, full text, character, tag search |
| 6. Sharing and Portability | **A. Export only** | Download and share manually |

### All Versions Retained

```typescript
interface AllVersionsRetained {
  // Unlimited history
  retention: 'unlimited';
  
  // Every save preserved
  savePolicy: 'every-save';
  
  // Efficient storage
  storageMethod: 'delta-compression';  // Store diffs between versions
  
  // Organization
  versionList: {
    display: 'timeline';
    filterable: true;
    searchable: true;
  };
}
```

### Branch from Any Point

```typescript
interface BranchFromAnyPoint {
  // Can branch anywhere in generated story
  branchPoints: 'anywhere';
  
  // At any paragraph
  granularity: 'paragraph-level';
  
  // Create new branch
  createBranch: (chapter: Chapter, paragraphIndex: number) => NewBranch;
  
  // Visual tree
  visualization: {
    type: 'tree-diagram';
    showAllBranches: true;
    colorCode: 'by-branch-lineage';
  };
  
  // Nested branches supported
  nesting: 'unlimited';
}

// Example:
// Original Branch
//   → Chapter 1 → Chapter 2 → Chapter 3
//                       ↓
//              New Branch (from Ch 2)
//                → Chapter 2B → Chapter 3B
```

### All Export Formats Supported

```typescript
interface AllExportFormats {
  // All formats available
  formats: {
    txt: {
      name: 'Plain Text';
      extension: '.txt';
      useCase: 'Universal, simple';
    };
    md: {
      name: 'Markdown';
      extension: '.md';
      useCase: 'Rich formatting, web';
    };
    epub: {
      name: 'EPUB';
      extension: '.epub';
      useCase: 'E-book readers';
    };
    pdf: {
      name: 'PDF';
      extension: '.pdf';
      useCase: 'Formatted document';
    };
    html: {
      name: 'HTML';
      extension: '.html';
      useCase: 'Web publishing';
    };
    docx: {
      name: 'Word Document';
      extension: '.docx';
      useCase: 'Word processing';
    };
  };
  
  // Export settings
  settings: {
    includeMetadata: true;
    includeChapterTitles: true;
    customStyling: true;
  };
}
```

### Branch-Based Library Organization

```typescript
interface BranchBasedLibraryOrganization {
  // Organized by branch tree
  structure: 'branch-tree';
  
  // Visual hierarchy
  hierarchy: {
    root: 'Source Manga';
    branches: 'Branch Lines';
    chapters: 'Generated Chapters';
  };
  
  // Display
  viewModes: {
    tree: 'Hierarchical tree view';
    list: 'Flattened list with branch tags';
    grid: 'Card grid with branch colors';
  };
  
  // Navigation
  navigation: 'click-branch-to-expand';
}
```

### Comprehensive Search

```typescript
interface ComprehensiveSearch {
  // All search types
  searchTypes: {
    title: {
      scope: 'story-titles';
      speed: 'instant';
    };
    fullText: {
      scope: 'entire-content';
      speed: 'fast-indexed';
    };
    character: {
      scope: 'character-presence';
      filter: 'characters-in-story';
    };
    tags: {
      scope: 'user-defined-tags';
      autocomplete: true;
    };
  };
  
  // Combined search
  combinedQueries: true;
  
  // Example: "character:Kira AND tag:dark-ending AND full-text:ritual"
}
```

### Export-Only Sharing

```typescript
interface ExportOnlySharing {
  // No in-app sharing
  sharingMethods: {
    inApp: false;
    links: false;
    cloud: false;
    collaboration: false;
    publishing: false;
  };
  
  // Export and manual share
  export: {
    formats: 'all-supported';
    download: 'direct-download';
    shareMethod: 'user-manual';
  };
  
  // Privacy-first approach
  privacy: 'maximum';
  
  // User controls all sharing
  userControl: 'complete';
}
```

---

## Status: ✅ ALL SUB-COMPONENTS COMPLETE

**Component 6: Story Continuation Engine fully interrogated and specified.**
