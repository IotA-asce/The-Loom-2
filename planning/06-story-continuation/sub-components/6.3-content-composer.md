# Sub-Component 6.3: Content Composer

## Purpose
Write the actual chapter content — prose, dialogue, description, and action that brings the outline to life.

---

## Requirements Gathering

### Question 1: Generation Approach

**Should content be generated all at once or scene-by-scene?**

Options:
- **A. All at once:** Generate full chapter in one request
- **B. Scene-by-scene:** Generate each scene separately
- **C. Hybrid:** Generate scene groups (2-3 at a time)
- **D. Streaming:** Stream content as it's generated
- **E. Iterative:** Generate, review, expand

Considerations:
- All at once = better flow but harder to control
- Scene-by-scene = easier to manage but may lose continuity
- Streaming = good UX but complex implementation

### Question 2: Handling Stuck Generation

**How do we handle writer's block or stuck generation?**

Options:
- **A. Timeout and retry:** If slow, cancel and retry
- **B. Fallback prompt:** Switch to simpler prompt
- **C. Skip and continue:** Mark section, move on
- **D. User intervention:** Pause, ask user for guidance
- **E. Parallel attempts:** Generate multiple versions simultaneously

Considerations:
- Some scenes are inherently harder
- User patience for delays
- Quality shouldn't suffer

### Question 3: Content Streaming

**Should we stream content as it's generated?**

Options:
- **A. Full streaming:** Show words as they appear
- **B. Paragraph streaming:** Show paragraph when complete
- **C. Scene streaming:** Show scene when complete
- **D. No streaming:** Show when chapter complete
- **E. Optional:** User can enable/disable streaming

Considerations:
- Streaming = engaging but may show low-quality drafts
- Complete = polished but less interactive
- Paragraph = good balance

### Question 4: Quality Consistency

**How do we ensure consistent quality throughout the chapter?**

Options:
- **A. Single generation:** One request maintains consistency
- **B. Style guide enforcement:** Enforce rules throughout
- **C. Post-generation polish:** Improve weak sections after
- **D. Quality checkpoints:** Validate after each scene
- **E. Iterative refinement:** Generate, review, improve

Considerations:
- Beginnings often stronger than endings
- Fatigue can affect quality
- Different scenes have different demands

### Question 5: Dialogue-to-Narration Balance

**How should we balance dialogue vs. narration?**

Options:
- **A. Match original:** Same ratio as source manga
- **B. User preference:** User sets ratio
- **C. Scene-appropriate:** Action = more narration, drama = more dialogue
- **D. Genre standard:** Follow genre conventions
- **E. Dynamic:** AI decides based on scene needs

Considerations:
- Manga often dialogue-heavy
- Novels balance differently
- Scene type affects ideal ratio

### Question 6: Description Density

**How much description should be included?**

Options:
- **A. Minimal:** Focus on action and dialogue
- **B. Moderate:** Key sensory details only
- **C. Rich:** Detailed setting and atmosphere
- **D. User preference:** User sets density
- **E. Original-matching:** Match source manga's description level

Considerations:
- Too little = white room syndrome
- Too much = slow pacing
- Genre affects expectations

---

## Technical Considerations

### Content Generation Flow

```typescript
interface ContentGeneration {
  // Approach
  approach: 'all-at-once' | 'scene-by-scene' | 'streaming';
  
  // For scene-by-scene
  sceneIterator: AsyncGenerator<SceneContent>;
  
  // For streaming
  stream: ReadableStream<string>;
  
  // Quality control
  qualityCheckpoints: boolean;
  
  // Fallbacks
  fallbackStrategy: 'retry' | 'simplify' | 'skip';
}

interface SceneContent {
  sequence: number;
  content: string;
  wordCount: number;
  quality: number;
}
```

---

## Decisions Recorded

| Question | Decision | Rationale |
|----------|----------|-----------|
| 1. Generation Approach | **E. Iterative** | Generate, review, expand for quality |
| 2. Handling Stuck | **A + D. Timeout/retry + User intervention** | Auto-retry first, then ask user |
| 3. Content Streaming | **D. No streaming** | Show complete polished chapter |
| 4. Quality Consistency | **B. Style guide enforcement** | Enforce rules throughout generation |
| 5. Dialogue Balance | **A. Match original** | Same ratio as source manga |
| 6. Description Density | **C + D. Rich + User preference** | Rich default, user can adjust |

### Iterative Generation Approach

```typescript
interface IterativeGeneration {
  // Multi-pass generation
  phases: [
    {
      name: 'draft';
      goal: 'Get core content down';
      quality: 'functional';
    },
    {
      name: 'review';
      goal: 'Identify weak sections';
      output: 'improvement-areas';
    },
    {
      name: 'expand';
      goal: 'Flesh out thin sections';
      focus: 'description, emotion, dialogue';
    },
    {
      name: 'polish';
      goal: 'Final quality pass';
      focus: 'style, voice, flow';
    }
  ];
  
  // Each phase feeds into next
  pipeline: 'draft → review → expand → polish';
}
```

### Timeout/Retry + User Intervention

```typescript
interface StuckGenerationHandling {
  // First: Automatic retry
  autoRetry: {
    enabled: true;
    maxRetries: 3;
    timeout: 30000;  // 30 seconds
    backoffStrategy: 'exponential';
  };
  
  // If retries fail: User intervention
  userIntervention: {
    trigger: 'after-max-retries';
    options: {
      simplify: 'Generate simpler version';
      skip: 'Skip this section for now';
      guide: 'User provides guidance';
      manual: 'User writes this section';
    };
  };
}

// Flow:
// 1. Try generation (up to 3 times)
// 2. If all fail → "Having trouble with this section"
// 3. User chooses: simplify/skip/guide/manual
// 4. Continue generation
```

### Complete Chapter Display (No Streaming)

```typescript
interface NoStreamingDisplay {
  // User sees loading state
  loadingUI: {
    message: 'Crafting your chapter...';
    progress: 'phase indicator';  // Draft → Review → Expand → Polish
    estimatedTime: '60-90 seconds';
  };
  
  // Only show when complete
  revealWhen: 'chapter-complete';
  
  // Benefits:
  // - Polished output only
  // - No jarring quality changes
  // - Better reading experience
  // - Easier to review
  
  // Drawback: User waits longer
  // Mitigation: Clear progress indication
}
```

### Style Guide Enforcement

```typescript
interface StyleGuideEnforcement {
  // Enforce throughout generation
  enforcement: 'continuous';
  
  styleRules: {
    // From Component 3 analysis
    sentenceLength: 'target-range';  // e.g., 15-25 words average
    paragraphLength: 'target-range'; // e.g., 3-5 sentences
    dialogueRatio: 'match-original'; // From source manga
    descriptionDensity: 'rich';      // User-adjustable
    vocabularyLevel: 'match-genre';
    tenseConsistency: 'maintain';
    povConsistency: 'maintain';
  };
  
  // Check each section against rules
  validate: (section: string) => StyleViolation[];
  
  // Auto-correct or flag
  correctionMode: 'auto-fix-minor' | 'flag-major';
}
```

### Match Original Dialogue Balance

```typescript
interface MatchOriginalDialogueBalance {
  // Analyze original manga
  analysis: {
    dialoguePercentage: number;  // e.g., 45% of content
    narrationPercentage: number; // e.g., 55% of content
    internalMonologueRatio: number;
    actionDescriptionRatio: number;
  };
  
  // Target in generated content
  target: 'match-original';
  tolerance: '±10%';
  
  // Per-scene adjustment allowed
  sceneFlexibility: '±15%';
  // (Action scenes more narration, drama scenes more dialogue)
}

// Example: Original manga = 40% dialogue, 60% narration
// Generated chapters target: 35-45% dialogue, 55-65% narration
```

### Rich Description + User Preference

```typescript
interface RichDescriptionWithUserPreference {
  // Default: Rich
  defaultDensity: 'rich';
  
  richDescription: {
    sensoryDetails: 'all-five-senses';
    atmosphere: 'mood-setting';
    characterInternals: 'thoughts-and-feelings';
    setting: 'vivid-world-building';
    action: 'dynamic-movement';
  };
  
  // User can adjust
  userAdjustable: true;
  
  adjustmentOptions: {
    minimal: 'Action and dialogue only';
    moderate: 'Key sensory details';
    rich: 'Full immersive description';
    custom: 'User specifies focus areas';
  };
  
  // Per-chapter override
  perChapterOverride: true;
}
```

---

## Status: ✅ Interrogation Complete

**Next: Sub-Component 6.4 — Voice Synthesizer**
